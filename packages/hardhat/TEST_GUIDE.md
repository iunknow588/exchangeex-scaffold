# ExchangeEx 合约测试指南

## 📋 测试概述

本指南将帮助您完整测试已部署的 ExchangeEx 合约。合约已成功部署到 Injective 测试网，地址为：`0x178Fc07106BAda5d423003d62e8aABb0850e1713`

## 🚀 测试步骤

### 第一步：启动本地开发环境

1. **启动本地区块链网络**
   ```bash
   yarn chain
   ```

2. **启动前端应用**
   ```bash
   yarn start
   ```

3. **访问测试页面**
   打开浏览器访问：http://localhost:3000/exchange-test

### 第二步：连接钱包

1. **安装 MetaMask 钱包**
   - 如果还没有安装，请从 [MetaMask 官网](https://metamask.io/) 下载安装

2. **配置 Injective 测试网**
   - 网络名称：Injective Testnet
   - Chain ID：1439
   - RPC URL：https://testnet.sentry.tm.injective.network:443
   - 区块浏览器：https://testnet.blockscout.injective.network

3. **连接钱包到测试页面**
   - 在测试页面点击连接钱包
   - 确保钱包已切换到 Injective 测试网

### 第三步：基础功能测试

#### 3.1 合约信息验证
- ✅ 检查合约地址是否正确显示
- ✅ 验证默认子账户ID是否正确
- ✅ 确认当前钱包地址的授权状态

#### 3.2 权限管理测试
1. **授权新交易员**
   - 在"权限管理"区域输入要授权的地址
   - 点击"授权交易员"按钮
   - 确认交易并等待确认
   - 验证授权状态是否更新

2. **撤销交易员授权**
   - 使用合约的 `revokeTrader` 功能
   - 验证授权状态是否被撤销

#### 3.3 子账户管理测试
1. **生成子账户ID**
   - 修改 nonce 值
   - 观察生成的子账户ID是否正确
   - 验证子账户ID格式

2. **查看子账户存款**
   - 查询子账户的存款信息
   - 验证余额显示

### 第四步：交易功能测试

#### 4.1 存款功能测试
1. **准备测试数据**
   - 子账户ID：使用默认子账户或生成新的
   - 代币类型：inj
   - 数量：输入测试金额（如 0.1）

2. **执行存款操作**
   - 点击"存款"按钮
   - 确认交易
   - 等待交易确认
   - 验证存款是否成功

#### 4.2 现货订单测试
1. **创建买入订单**
   - 市场ID：INJ/USDT
   - 子账户ID：使用已存款的子账户
   - 价格：输入买入价格
   - 数量：输入买入数量
   - CID：输入订单标识符
   - 点击"买入订单"按钮

2. **创建卖出订单**
   - 使用相同的参数格式
   - 点击"卖出订单"按钮

3. **验证订单创建**
   - 检查交易哈希
   - 在区块浏览器中查看交易详情
   - 验证订单事件是否正确触发

### 第五步：高级功能测试

#### 5.1 批量操作测试
- 测试批量创建订单
- 测试批量取消订单
- 测试批量存款操作

#### 5.2 衍生品订单测试
- 创建衍生品限价订单
- 测试市价订单功能
- 验证订单响应数据

#### 5.3 资金转移测试
- 测试子账户间资金转移
- 测试向外部子账户转移资金
- 验证提款功能

### 第六步：事件监控测试

#### 6.1 监控合约事件
- 现货订单创建事件
- 现货订单取消事件
- 衍生品订单事件
- 交易员授权/撤销事件

#### 6.2 查询历史事件
- 使用区块浏览器查询历史事件
- 验证事件数据格式
- 检查事件索引

## 🔧 故障排除

### 常见问题

1. **钱包连接失败**
   - 确保 MetaMask 已安装并解锁
   - 检查网络配置是否正确
   - 尝试刷新页面重新连接

2. **交易失败**
   - 检查账户余额是否充足
   - 确认 Gas 费用设置
   - 验证交易参数格式

3. **合约调用失败**
   - 检查合约地址是否正确
   - 确认函数参数类型
   - 验证调用权限

### 调试工具

1. **区块浏览器**
   - 地址：https://testnet.blockscout.injective.network
   - 查看交易详情和合约状态

2. **控制台日志**
   - 打开浏览器开发者工具
   - 查看控制台错误信息

3. **网络状态检查**
   - 验证 RPC 连接状态
   - 检查网络延迟

## 📊 测试结果记录

### 测试检查清单

- [ ] 钱包连接成功
- [ ] 合约地址正确显示
- [ ] 默认子账户ID正确
- [ ] 授权状态查询正常
- [ ] 授权新交易员成功
- [ ] 撤销交易员授权成功
- [ ] 子账户ID生成正确
- [ ] 存款功能正常
- [ ] 买入订单创建成功
- [ ] 卖出订单创建成功
- [ ] 事件监控正常
- [ ] 批量操作测试通过

### 性能指标

- **交易确认时间**：平均 X 秒
- **Gas 费用**：平均 X INJ
- **成功率**：X%
- **错误率**：X%

## 🎯 测试完成标准

1. **基础功能**：所有核心功能正常工作
2. **用户界面**：界面响应正常，用户体验良好
3. **错误处理**：错误信息清晰，故障排除容易
4. **性能表现**：交易响应时间合理，Gas 费用可接受
5. **安全性**：权限控制正确，数据验证有效

## 📝 测试报告模板

```
测试日期：YYYY-MM-DD
测试人员：[姓名]
测试环境：Injective Testnet
合约地址：0x178Fc07106BAda5d423003d62e8aABb0850e1713

测试结果：
- 基础功能：[通过/失败]
- 交易功能：[通过/失败]
- 权限管理：[通过/失败]
- 事件监控：[通过/失败]

发现的问题：
1. [问题描述]
2. [问题描述]

建议改进：
1. [改进建议]
2. [改进建议]

总体评价：[优秀/良好/需要改进]
```

---

**注意**：请根据实际测试情况更新测试结果和发现的问题。如有疑问，请参考项目文档或联系开发团队。
